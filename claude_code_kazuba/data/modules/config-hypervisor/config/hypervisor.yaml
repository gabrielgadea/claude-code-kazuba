# Hypervisor Configuration
# Central automation settings for the Kazuba framework.

context_management:
  max_tokens: 180000
  warning_threshold: 0.70    # 70% — start optimizing context usage
  critical_threshold: 0.85   # 85% — checkpoint and /clear recommended
  compaction_strategy: "summarize_and_checkpoint"
  checkpoint_format: "toon"  # msgpack-based

thinking:
  levels:
    - name: low
      trigger: "Simple tasks, single-file edits, typo fixes"
      token_budget: 1000
      keywords: ["think"]

    - name: medium
      trigger: "Multi-file changes, standard debugging, feature implementation"
      token_budget: 5000
      keywords: ["think hard"]

    - name: high
      trigger: "Architecture decisions, complex debugging, cross-system changes"
      token_budget: 15000
      keywords: ["think harder"]

    - name: critical
      trigger: "Paradigm shifts, security-critical decisions, production incidents"
      token_budget: 30000
      keywords: ["ultrathink"]

  default_level: medium

circuit_breakers:
  max_turns:
    threshold: 50
    action: "warn_and_checkpoint"
    message: "50 turns reached. Consider checkpointing and starting fresh."

  context_overflow:
    threshold: 0.90  # 90% of max_tokens
    action: "force_checkpoint"
    message: "Context at 90%. Checkpointing state and recommending /clear."

  loop_detection:
    max_retries: 3
    window_seconds: 300
    action: "escalate_to_user"
    message: "Same error 3 times in 5 minutes. Escalating — possible wrong approach."

  quality_degradation:
    metric: "response_coherence"
    threshold: 0.60
    action: "warn_and_suggest_clear"
    message: "Response quality degrading. Context may be polluted."

  consecutive_failures:
    threshold: 5
    action: "stop_and_diagnose"
    message: "5 consecutive failures. Stopping to diagnose root cause."

quality:
  min_score: 0.80
  degradation_alert: 0.70
  dimensions:
    - functional
    - robust
    - readable
    - documented
    - secure
    - no_regression
  weights:
    functional: 0.25
    robust: 0.20
    readable: 0.15
    documented: 0.15
    secure: 0.15
    no_regression: 0.10

sla:
  task_latency:
    p50: "30s"
    p95: "120s"
    p99: "300s"
  success_rate:
    target: 0.95
    alert_threshold: 0.90
